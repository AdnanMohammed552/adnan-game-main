{% extends 'base.html' %}
{% block content %}
<meta name="viewport" content="width=device-width, initial-scale=1">

<button id="toggle-button" class="btn btn-primary">
    <i id="eye-icon" class="fas fa-eye"></i>
    <i id="eye-slash-icon" class="fas fa-eye-slash d-none"></i>
  </button>
  <script>
    $(document).ready(function() {
      $("#toggle-button").click(function() {
        $("#video").toggle();
      });
    });
  </script>
<div id="data"></div>
<input type="text" name="" id="pass">
<button id="sub">sub</button>

<script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.18.4"></script>
       {{ room_code|json_script:'json-roomcode' }}

	<script>
        document.getElementById('sub').disabled=true
        document.getElementById('pass').disabled=true

		</script>
        <style>
            .video-container {
                position: relative;
                width: 100%;
                height: 0;
                padding-bottom: 56.25%;
              }
              
              #video {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                object-fit: cover;
              }
              
              
              
        </style>
        <style>
           
            #end_game{
                background-color: red !important;
            }
          </style>
          <style>
            .btn-lg {
              padding: 12px 24px;
              font-size: 24px;
            }
            
            .custom-container {
              height: 100vh;
              display: flex;
              justify-content: center;
              align-items: center;
            }
            
            .custom-container .text-center {
              margin: 0;
            }
          </style>
<script>
    document.getElementById('toggle-button').style.display='none'
    let pass1=''
    roomCode='{{room_code}}'
    const gameSocketquiz = new WebSocket(
        
    'wss://' + window.location.host + '/ws/' + roomCode + '/quiz/'
  )
  gameSocketquiz.onmessage=function(e){
    const data = JSON.parse(e.data)
    if (data.mypass!=false){
        document.getElementById('sub').disabled=false
        document.getElementById('pass').disabled=false
        console.log('gwegcc')
        pass1=data.mypass
            }

  }

  document.getElementById('sub').onclick=function(){
    txt = document.getElementById('pass').value
 
      
      if (txt === pass1) {
        document.getElementById('toggle-button').style.display='block'
        document.getElementById('sub').style.display='none'
        document.getElementById('pass').style.display='none'
        document.getElementById('data').innerHTML+=`
                    <center><h3 id="camera_correct"></h3></center>
                    <div class="container custom-container">
                        <div class="text-center mt-0 mb-0">
                          <button class="btn btn-primary btn-lg mb-3" id="next">End question</button>
                          <button class="btn btn-danger btn-lg" id="end_game">End game</button>
                        </div>
                      </div>
                    
        
        <div class="video-container">
            
            <video id="video" width="1000" height="1000" autoplay="autoplay" playsinline autoplay controls></video>
            </div>
            <center>
            
        </center>
        
        `

      
      const codeReader = new ZXing.BrowserQRCodeReader();
    
      const roomCode = JSON.parse(document.getElementById('json-roomcode').textContent);
      
  
      const ws = new WebSocket('wss://' + window.location.host + '/ws/' + roomCode + '/quiz/');
      ws.onmessage = function(e){
          const data = JSON.parse(e.data)
          if (data.camera_correct != false){
              document.getElementById('camera_correct').innerHTML = data.camera_correct
          }
      }
  
          function scan() {
              codeReader.decodeFromInputVideoDevice(undefined, 'video').then((result) => {
                  // Send WebSocket message with scanned code
                  ws.send(JSON.stringify({'exam':result.text}));
                  // Scan again
                  scan();
              }).catch((err) => {
                  console.error(err);
                  // Scan again
                  scan();
              });
          }
  
          ws.onopen = function(event) {
              // Start scanning for QR codes
              scan();
          };
        window.onbeforeunload = function (e) {
        
            if ((document.getElementById('endingEle').innerHTML)!=='Game had been ended'){
            e = e || window.event;
        
            // For IE and Firefox prior to version 4
            if (e) {
                e.returnValue = 'Sure?';
                
            }
        
            // For Safari
            return 'Sure?';
          }
        };
    
        let x = 'end'
        document.getElementById('end_game').onclick=function(){
            ws.send(JSON.stringify({
                'end_clicked':true
            }))
        }
    
    
        document.getElementById('next').onclick = function(){
            if (x=='next'){
            x='end'
            document.getElementById('next').innerHTML='End question'
    
            }
            else if (x=='end'){
                x='next'
                document.getElementById('next').innerHTML='Next question'
            }
            ws.send(JSON.stringify({
                'next':true
            }))
        }
    
        
        const videoContainer = document.querySelector('.video-container');
    
    function resizeVideoContainer() {
    const screenHeight = window.innerHeight;
    const videoContainerHeight = screenHeight - videoContainer.offsetTop;
    videoContainer.style.height = `${videoContainerHeight}px`;
    }
    
    window.addEventListener('resize', resizeVideoContainer);
    resizeVideoContainer();
    
       }}
</script>

{% endblock %}
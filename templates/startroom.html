{% extends 'base.html' %}

{% block title %}
<title>Room Admin</title>
{% endblock %}
{% block content %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" integrity="sha512-qZvrmS2ekKPF2mSznTQsxqPgnpkI4DNTlrdUmTzrDgektczlKNRRhy5X5AAOnx5S09ydFYWWNSfcEqDTTHgtNA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
<!-- Font Awesome -->
<style>

</style>
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
  rel="stylesheet"
/>
<!-- Google Fonts -->
<link
  href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
  rel="stylesheet"
/>
<!-- MDB -->
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/5.0.0/mdb.min.css"
  rel="stylesheet"
/>
<!-- MDB -->
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/5.0.0/mdb.min.js"
></script>  
<div id="anann">
  <p>adnan</p>
</div>
<div class="container-xxl">
  <div id="users">
        
     <h3 id="flep">ÿßŸÑÿ≠ÿ±ŸÅ ÿßŸÑŸÇÿßÿØŸÖ ŸáŸà<span class="badge badge-primary" id="leetter"></span></h5>   
     
  </div>
    <button type="button" class="btn btn-primary btn-rounded" id="done">Start game</button>
    

   
    <div class="btn-group" role="group" aria-label="Basic example">
      <button type="button" class="btn btn-primary btn-rounded" id="send" style="font-size: 20px;">Start game</button>   
      <button type="button" class="btn btn-danger btn-rounded" id="end"  style="font-size: 20px;">End game</button>
      <button id="view">Next letter</button>
    </div>
    <button id="visable">üëÅ</button>
  </div>
  <div id="pdfgenerator"></div>
 <style>
  #removeme {
    width: 150px; /* set a width so it doesnt change upon hover */
     border: 0px solid #004B84;
     background: green;
     padding: 3px 21px;
     -webkit-border-radius: 16px;
     -moz-border-radius: 16px;
     border-radius: 16px;
     color: #ffffff;
     font-size: 12px;
     font-family: Questrial;
     text-decoration: none;
     vertical-align: middle;
     letter-spacing: 2px;
  }
  
  #removeme:hover span {
    display:none
  }
  
  #removeme:hover:before {
    content:"Remove Player!";
  }
  
  #removeme:hover {
    background-color: red;
  }
 </style>
{{ room_code|json_script:'json-roomcode' }}
<script>
  var totalarray=[]
  const fetchedarray = []

  document.getElementById('done').style.display = "none"
  document.getElementById('flep').style.display ="none"
  function generateRandomColor(){
    
      let color = "#";
      for (let i = 0; i < 3; i++)
        color += ("0" + Math.floor(((1 + Math.random()) * Math.pow(16, 2)) / 2).toString(16)).slice(-2);
      return color;
    }

  document.getElementById("visable").onclick =function(e){
    if ((window.getComputedStyle(document.getElementById('leetter')).display) === 'block'){
      document.getElementById('leetter').style.display="none"
    }
    else{
      document.getElementById('leetter').style.display="block"

    }
    
  }
  const roomCode = JSON.parse(document.getElementById('json-roomcode').textContent);
  const gameSocketlettr = new WebSocket(
        'ws://' + window.location.host + '/ws/' + roomCode + '/letter/'
        )
        const gameSocket2 = new WebSocket(
                'ws://' + window.location.host + '/ws/' + roomCode + '/'
                )
  gameSocketlettr.onclose = function(e){
    const gameSocketlettr = new WebSocket(
      'ws://' + window.location.host + '/ws/' + roomCode + '/letter/'
      )
  }
  document.querySelector('#view').disabled = true;
  
  const array2 =[]
  

    const waitForOpenConnection = (socket) => {
        return new Promise((resolve, reject) => {
            const maxNumberOfAttempts = 10
            const intervalTime = 200 //ms
    
            let currentAttempt = 0
            const interval = setInterval(() => {
                if (currentAttempt > maxNumberOfAttempts - 1) {
                    clearInterval(interval)
                    reject(new Error('Maximum number of attempts exceeded'))
                } else if (socket.readyState === socket.OPEN) {
                    clearInterval(interval)
                    resolve()
                }
                currentAttempt++
            }, intervalTime)
        })
    }
    console.log("it is " , roomCode)
    const array = []
    const gameSocket = new WebSocket(
        
        'ws://' + window.location.host + '/ws/' + roomCode + '/admin/'
      )
      gameSocket.onmessage = function (e) {
        console.log('done');
        const data = JSON.parse(e.data);
        console.log(data)
        if (data){
          const username = data.userName;
          console.log(username)
          
          array.push(username)
          if (username !==""){
            //document.getElementById('users').innerHTML += (
            // ' <button id="'+ username +'" onclick="userremove(\'' + username + '\')">'+ username +'</button>'
            //)
            //const h1Element = document.createElement("h1");
            //h1Element.textContent = username;
            //document.body.append(h1Element);
          }
          }
        

    }
      function userremove(x){
        const gameSocketkick = new WebSocket(
        'ws://' + window.location.host + '/ws/' + roomCode + '/'
        )
        gameSocketkick.onopen = function(e){
        gameSocketkick.send(JSON.stringify({
          'kick':true,
          'user':x
        }))
        document.getElementById('div_id'+x).remove()
      }

      }
      gameSocket.onclose = function (e) {
        console.log('fall ');
      }
      document.querySelector('#send').onclick = function(e){
        const started = false
        console.log(started)
        gameSocket.send(JSON.stringify({
          'started' : true,
          'room' : roomCode,
        
        }))  
        document.getElementById('send').style.display = "none"
        gameSocket2.onmessage = function(e){
          const data = JSON.parse(e.data)
          if (data.ready){
            document.getElementById('done').click()

          }
        }

      }
      document.querySelector('#done').onclick = function(e){
        document.getElementById('done').remove()
        
        const gameSocket2 = new WebSocket(
        'ws://' + window.location.host + '/ws/' + roomCode + '/'
        )
        gameSocket2.onopen = function(){
          gameSocket2.send(JSON.stringify({
            'RoomCode':roomCode,
            'players': array,
            'error':false,
            'review':false
          }))
          
        
        gameSocket2.onmessage = function(e){
          const data = JSON.parse(e.data)

          if (data.current_letter_this!==null&&typeof data.current_letter_this!=="undefined"&&data.current_letter_this!==""){
            console.log('yeeesa')
            document.querySelector('#leetter').innerHTML =data.current_letter_this;
          }
          console.log(data)
          if ((data.error!==true)||(data.Noun!=='')){
          
          if ((data.noun_result === null)||(typeof data.noun_result ==='undefined')){
            
          noun = data.Noun
          RoomCode =data.RoomCode
          UserName =data.UserName
          animal =data.animal
          choosens =data.choosens
          countries =data.countries
          end =data.end
          gnoun =data.gnoun
          inanimate =data.inanimate
          plants =data.plants
          pret = data.pret
          current_letter_this=data.current_letter_this1
          admin_letter=data.admin_letter
          const playersfetch=data.playersfetch
          console.log('I want is:',playersfetch)
          console.log('first is',fetchedarray)

          if (typeof playersfetch !== 'undefined'){
          const playersfetch1 = playersfetch.replaceAll('"', '')
          const playersfetch2= playersfetch1.replace('[','')
          const playersfetch3 = playersfetch2.replace(']','')
          const playersfetch4 = playersfetch2.replaceAll("'","")
          
          console.log('its 4',playersfetch4)
          const playersfetch5 = playersfetch3.split(',')
          console.log('fetched are',playersfetch5)
          for (i of playersfetch5){
            z = i.replaceAll("'",'')
            
            if (z!==' '){
              t = z.replace(/\s+/g, '')
          fetchedarray.push(t)
          console.log('fetchedarray  gis',fetchedarray,t)}
          else{
            break
          }

          for (uae of fetchedarray){
            totalarray.push(uae)
          }
        }
        gameSocket2.send(JSON.stringify({
          'oneortwo':'one',
          'review':true,
          'error':true,
          'players_game':array
        }))
          for (u of fetchedarray){
              console.log('index is ',fetchedarray.indexOf(u))
              const div = document.createElement("div");
              div.setAttribute('id','div_id'+u);
              document.getElementById('pdfgenerator').append(div);
              document.getElementById('div_id'+u).innerHTML += (
              '<div class="accordion" id="'+ 
              'accordionExample'+ fetchedarray.indexOf(u) +
              '">'+
                '<div class="accordion-item" >'+
                ' <h2 class="accordion-header" id="headingOne">'+
                    '<button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne'+u+'" aria-expanded="true" aria-controls="collapseOne">'+
                      u +
                    '</button>' +
                  '</h2>'+
                  '<div id="collapseOne'+u+'" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#'
                  +'accordionExample'+fetchedarray.indexOf(u)+
                  '">"' +
                  '<div style="background-color:'+generateRandomColor()+'" class="accordion-body" ' + 'id="' + u + '">'+
                      '<table class="table table-bordered border-primary">'+
                        '<thead>'+
                          '<tr>'+
                            '<th style="font-size:20px;" scope="col">ÿßŸÑŸÑÿßÿπÿ®</th>'+
                            '<th style="font-size:20px;" scope="col">ÿßŸÑÿ≠ÿ±ŸÅ </th>'+
                          ' <th style="font-size:20px;" scope="col">ÿ•ÿ≥ŸÖ </th>'+
                            '<th style="font-size:20px;" scope="col">ÿ•ÿ≥ŸÖ ÿ®ŸÜÿ™</th>'+
                            '<th style="font-size:20px;" scope="col">ÿ≠ŸäŸàÿßŸÜ </th>'+
                            '<th style="font-size:20px;" scope="col">ŸÜÿ®ÿßÿ™ </th>'+
                            '<th style="font-size:20px;" scope="col">ÿ¨ŸÖÿßÿØ </th>'+
                            '<th style="font-size:20px;" scope="col">ÿ®ŸÑÿßÿØ </th>'+
                            '<th style="font-size:20px;" scope="col">ÿßŸÑÿ∫ÿ±ŸÅÿ© </th>'+
                            '<th style="font-size:20px;" scope="col">ŸÖÿ¨ŸÖŸàÿπ </th>'+
                          '</tr>'+
                        '</thead>'+
                        '<tbody id="divv'+u+'">'+
                      
                        '</tbody>'+
                        
                    '</table>'+
                    '</div>'+
                  '</div>'+
                '</div>'+
              
                '</div>'
              
                )
          }
          

        }
      
          else if(typeof playersfetch === 'undefined'){
            console.log('current username is',UserName)
            if (data.main_row === true){
              gameSocket2.send(JSON.stringify({
                'oneortwo':'two',
                'review':true,
                'error':true,
                'UserName':UserName,
                'admin_letter':admin_letter,
                'noun_review':noun,
                'gnoun':gnoun,
                'animal':animal,
                'plants':plants,
                'countries':countries,
                'inanimate':inanimate,
                'RoomCode':RoomCode
              }))
              if (data.star === true){
                var noun_result = 'noun_result'
                var gnoun_result = "gnoun_result"
                var animal_result = "animal_result"
                var plants_result = "plants_result"
                var countries_result = "countries_result"
                var inanimate_result = "inanimate_result"

            document.getElementById('divv'+UserName).innerHTML += (
            
                 
                  "<tr>"+ 
                    '<th scope="row">‚≠ê<button id="removeme" type="button" onclick="userremove(\'' + data.UserName + '\')" class="btn btn-primary btn-rounded" data-hover="CLICK ME" data-active="IM ACTIVE"><span>'+data.UserName+'</span></button> </th>'+
                    "<td style='font-size:18px;' id = 'letter'>"+ admin_letter +"</td>"+
                    "<td style='font-size:18px;' id = 'noun'>"+ noun +"</td>"+
                    "<td style='font-size:18px;' id = 'gnoun'>"+ gnoun +"</td>"+
                    "<td style='font-size:18px;' id = 'animalNoun'>"+ animal +"</td>"+
                    "<td style='font-size:18px;' id = 'plants'>"+plants +"</td>"+
                    "<td style='font-size:18px;' id = 'inanimate'>"+ inanimate +"</td>"+
                    "<td style='font-size:18px;' id = 'countries'>"+ countries +"</td>"+
                    "<td style='font-size:18px;' id = 'room'>"+ RoomCode +"</td>"+
                    "<td style='font-size:18px;' id = 'sum'>"+  +"</td>"+
                    
                  "</tr>"+
                  "<tr>"+
                    '<td scope="row"></td>'+
                    '<td scope="row"></td>'+
                    
                    '<td >'+
                      
                      '<select style="font-size:16px;" onChange="OnSelectedIndexChange(\'' + UserName + '\',\'' + noun_result+'\')" id="noun_result'+UserName+'" >'+
                        '<option style="font-size:16px;" href="#">0</option>'+
                       ' <option style="font-size:16px;" href="#">5</option>'+
                        '<option style="font-size:16px;" href="#">10</option>'+
                      '</select>'+
                      '<div id="noun_resulttd'+ UserName +'">'+

                        '<\/div>'+
                        
                    '</td>'+
                    '<td>'+
                      
                      
                      '<select style="font-size:16px;" onChange="OnSelectedIndexChange(\'' + UserName + '\',\'' + gnoun_result+'\' )"  id="gnoun_result'+UserName+'" >'+
                        '<option style="font-size:16px;" href="#">0</option>'+
                       ' <option style="font-size:16px;" href="#">5</option>'+
                        '<option style="font-size:16px;" href="#">10</option>'+
                      '</select>'+
                      '<div id="gnoun_resulttd'+ UserName +'">'+

                        '<\/div>'+
                    '</td>'+
                    '<td>'+
                     
                      
                      '<select style="font-size:16px;" onChange="OnSelectedIndexChange(\'' + UserName + '\',\'' + animal_result+'\')"  id="animal_result'+UserName+'" >'+
                        '<option style="font-size:16px;" href="#">0</option>'+
                       ' <option style="font-size:16px;" href="#">5</option>'+
                        '<option style="font-size:16px;" href="#">10</option>'+
                      '</select>'+
                      '<div id="animal_resulttd'+ UserName +'">'+

                        '<\/div>'+
                    '</td>'+
                    '<td>'+
                     
                      
                      '<select style="font-size:16px;" onChange="OnSelectedIndexChange(\'' + UserName + '\',\'' + plants_result +'\')"  id="plants_result'+UserName+'" >'+
                        '<option style="font-size:16px;" href="#">0</option>'+
                       ' <option style="font-size:16px;" href="#">5</option>'+
                        '<option style="font-size:16px;" href="#">10</option>'+
                      '</select>'+
                      '<div id="plants_resulttd'+ UserName +'">'+

                        '<\/div>'+
                    '</td>'+
                    '<td>'+
                     
                      
                      '<select style="font-size:16px;" onChange="OnSelectedIndexChange(\'' + UserName + '\',\'' + countries_result +'\')"  id="countries_result'+UserName+'" >'+
                        '<option style="font-size:16px;" href="#">0</option>'+
                       ' <option style="font-size:16px;" href="#">5</option>'+
                        '<option style="font-size:16px;" href="#">10</option>'+
                      '</select>'+
                      '<div id="countries_resulttd'+ UserName +'">'+

                        '<\/div>'+
                    '</td>'+
                    '<td>'+
                     
                      
                      '<select style="font-size:16px;" onChange="OnSelectedIndexChange(\'' + UserName + '\',\'' + inanimate_result +'\')"  id="inanimate_result'+UserName+'" >'+
                        '<option style="font-size:16px;" href="#">0</option>'+
                       ' <option style="font-size:16px;" href="#">5</option>'+
                        '<option style="font-size:16px;" href="#">10</option>'+
                      '</select>'+
                      '<div id="inanimate_resulttd'+ UserName +'">'+

                        '<\/div>'+
                    '<td class="success" id="sum'+UserName+'"></td>'+
                    '</td>'+
                    '<button type="submit" class="btn btn-primary" id="calc'+UserName+'"onclick="calc(\'' + UserName + '\' , \'' + admin_letter + '\' , \'' + noun + '\' ,\'' + gnoun + '\',\'' + animal + '\',\'' + plants + '\',\'' + inanimate + '\',\'' + countries + '\',\'' + RoomCode + '\')">Calculate</button>'


                
          )
        }
        else{
          var noun_result = 'noun_result'
          var gnoun_result = "gnoun_result"
          var animal_result = "animal_result"
          var plants_result = "plants_result"
          var countries_result = "countries_result"
          var inanimate_result = "inanimate_result"

          document.getElementById('divv'+UserName).innerHTML += (
            
                 
                  "<tr>"+ 
                    '<th scope="row"><button id="removeme" type="button" onclick="userremove(\'' + data.UserName + '\')" class="btn btn-primary btn-rounded" data-hover="CLICK ME" data-active="IM ACTIVE"><span>'+data.UserName+'</span></button> </th>'+
                    "<td style='font-size:18px;' id = 'letter'>"+ admin_letter +"</td>"+
                    "<td style='font-size:18px;' id = 'noun'>"+ noun +"</td>"+
                    "<td style='font-size:18px;' id = 'gnoun'>"+ gnoun +"</td>"+
                    "<td style='font-size:18px;' id = 'animalNoun'>"+ animal +"</td>"+
                    "<td style='font-size:18px;' id = 'plants'>"+plants +"</td>"+
                    "<td style='font-size:18px;' id = 'inanimate'>"+ inanimate +"</td>"+
                    "<td style='font-size:18px;' id = 'countries'>"+ countries +"</td>"+
                    "<td style='font-size:18px;' id = 'room'>"+ RoomCode +"</td>"+
                    "<td style='font-size:18px;' id = 'sum'>"+  +"</td>"+
                    
                  "</tr>"+
                  "<tr>"+
                    '<td scope="row"></td>'+
                    '<td scope="row"></td>'+
                    
                    '<td >'+
                      
                      
                      '<select style="font-size:16px;" onChange="OnSelectedIndexChange(\'' + UserName + '\',\'' + noun_result+'\')" id="noun_result'+UserName+'" >'+
                        '<option style="font-size:16px;" href="#">0</option>'+
                       ' <option style="font-size:16px;" href="#">5</option>'+
                        '<option style="font-size:16px;" href="#">10</option>'+
                      '</select>'+
                      '<div id="noun_resulttd'+ UserName +'">'+

                        '<\/div>'+
                    '</td>'+
                    '<td>'+
                      
                      '<select style="font-size:16px;" onChange="OnSelectedIndexChange(\'' + UserName + '\',\'' + gnoun_result+'\' )"  id="gnoun_result'+UserName+'" >'+
                        '<option style="font-size:16px;" href="#">0</option>'+
                       ' <option style="font-size:16px;" href="#">5</option>'+
                        '<option style="font-size:16px;" href="#">10</option>'+
                      '</select>'+
                      '<div id="gnoun_resulttd'+ UserName +'">'+

                        '<\/div>'+
                      
                    '</td>'+
                    '<td>'+
                      
                      
                      '<select style="font-size:16px;" onChange="OnSelectedIndexChange(\'' + UserName + '\',\'' + animal_result+'\')"  id="animal_result'+UserName+'" >'+
                        '<option style="font-size:16px;" href="#">0</option>'+
                       ' <option style="font-size:16px;" href="#">5</option>'+
                        '<option style="font-size:16px;" href="#">10</option>'+
                      '</select>'+
                      '<div id="animal_resulttd'+ UserName +'">'+

                        '<\/div>'+
                    '</td>'+
                    '<td>'+
                      
                      
                      '<select style="font-size:16px;" onChange="OnSelectedIndexChange(\'' + UserName + '\',\'' + plants_result +'\')"  id="plants_result'+UserName+'" >'+
                        '<option style="font-size:16px;" href="#">0</option>'+
                       ' <option style="font-size:16px;" href="#">5</option>'+
                        '<option style="font-size:16px;" href="#">10</option>'+
                      '</select>'+
                      '<div id="plants_resulttd'+ UserName +'">'+

                        '<\/div>'+
                    '</td>'+
                    '<td>'+
                      
                      
                      '<select style="font-size:16px;" onChange="OnSelectedIndexChange(\'' + UserName + '\',\'' + countries_result +'\')"  id="countries_result'+UserName+'" >'+
                        '<option style="font-size:16px;" href="#">0</option>'+
                       ' <option style="font-size:16px;" href="#">5</option>'+
                        '<option style="font-size:16px;" href="#">10</option>'+
                      '</select>'+
                      '<div id="countries_resulttd'+ UserName +'">'+

                        '<\/div>'+
                    '</td>'+
                    '<td>'+
                     
                      
                      '<select style="font-size:16px;" onChange="OnSelectedIndexChange(\'' + UserName + '\',\'' + inanimate_result +'\')"  id="inanimate_result'+UserName+'" >'+
                        '<option style="font-size:16px;" href="#">0</option>'+
                       ' <option style="font-size:16px;" href="#">5</option>'+
                        '<option style="font-size:16px;" href="#">10</option>'+
                      '</select>'+
                      '<div id="inanimate_resulttd'+ UserName +'">'+

                        '<\/div>'+
                    '<td class="success" id="sum'+UserName+'"></td>'+
                    '</td>'+
                    '<button type="submit" class="btn btn-primary" id="calc'+UserName+'"onclick="calc(\'' + UserName + '\' , \'' + admin_letter + '\' , \'' + noun + '\' ,\'' + gnoun + '\',\'' + animal + '\',\'' + plants + '\',\'' + inanimate + '\',\'' + countries + '\',\'' + RoomCode + '\')">Calculate</button>'


                
          )
        }
                  }
        }
          
          
      }
        
      }
    }
    }
      

  

    }
    function OnSelectedIndexChange(id,thisis){
      console.log('hfei'+id + thisis)
      
      const word_result = document.getElementById(thisis+id);
      console.log('word res is',word_result)
      const noun_result = word_result.options[word_result.selectedIndex].text;;
      if (noun_result == '5'){
        document.getElementById(thisis+'td'+id).innerHTML += (
          '<select style="font-size:16px;" onChange="changemark(\'' + id + '\',\'' + thisis + '\')" id="noun_result5'+id+''+thisis+'" >'+
            '<option style="font-size:10px;" href="#">--Choose similar player--</option>'+
            '<\/select>'
             )
             console.log(totalarray)
            for (name of fetchedarray){
              document.getElementById('noun_result5'+id+thisis).innerHTML += (
                '<option style="font-size:16px;" href="#">'+name+'</option>'
              )
            }
            document.querySelector('#noun_result5'+id+thisis).options.selectedIndex = 0;
            
            
          
        

      }
      else if (noun_result == '10'){
        document.getElementById('noun_result5'+id+thisis).remove()
      }
      else if (noun_result == '0'){
        document.getElementById('noun_result5'+id+thisis).remove()
      }


    }
    function changemark(id2,thisis2){
      const word_result = document.querySelector('#noun_result5'+id2+thisis2);
      const noun_result = word_result.options[word_result.selectedIndex].text;;
      console.log('tr is',id2)
      document.getElementById(thisis2+noun_result).getElementsByTagName('option')[1].selected = 'selected';
    }
    document.getElementById('end').onclick = function(e){
      
        var data=document.getElementById('pdfgenerator').innerHTML;
        var myWindow = window.open('', 'my div', 'height=400,width=600');
        myWindow.document.write('<html><head><title>my div</title>');
        /*optional stylesheet*/ //myWindow.document.write('<link rel="stylesheet" href="main.css" type="text/css" />');
        myWindow.document.write('</head><body >');
        myWindow.document.write(data);
        myWindow.document.write('</body></html>');
        myWindow.document.write(
        '<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA==" crossorigin="anonymous" referrerpolicy="no-referrer">'+
          '<\/script>'+
        '<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" integrity="sha512-qZvrmS2ekKPF2mSznTQsxqPgnpkI4DNTlrdUmTzrDgektczlKNRRhy5X5AAOnx5S09ydFYWWNSfcEqDTTHgtNA==" crossorigin="anonymous" referrerpolicy="no-referrer">'+'<\/script>'+
        '<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">'+
        '<link'+
         ' href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"'+
          'rel="stylesheet"'+
        '/>'+
     
        '<script src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/5.0.0/mdb.min.js"><\/script>'+
          '<script>'+
        'window.document.close(); '+

            'window.focus(); '+
            'window.print();'+
            'window.close();'+
        '<\/script>')
      const gameSocket1 = new WebSocket(
        
        'ws://' + window.location.host + '/ws/' + roomCode + '/'
        )
        
        console.log('socket is ',gameSocket1)
        sendMessage()
        function sendMessage(){
            // Wait until the state of the socket is not ready and send the message when it is...
            waitForSocketConnection(gameSocket1, function(){
                console.log("message sent!!!" , gameSocket1);
                gameSocket1.send(JSON.stringify({
                    'end' : true,
                    'room' : roomCode,
                
        
                }))
            });
        }
        function waitForSocketConnection(socket, callback){
            setTimeout(
                function () {
                    if (socket.readyState === 1) {
                        console.log("Connection is made")
                        if (callback != null){
                            callback();
                        }
                    } else {
                        console.log("wait for connection...")
                        waitForSocketConnection(socket, callback);
                    }
        
                }, 5); // wait 5 milisecond for the connection...
        }
      
      

    }
    
          function calc(x,a,b,c,d,r,f,g,h){
            console.log('its calc')
                const word_result = document.querySelector('#noun_result'+x);
                const noun_result = word_result.options[word_result.selectedIndex].text;;
                const wordgnoun_result = document.querySelector('#gnoun_result'+x);
                const gnoun_result = wordgnoun_result.options[wordgnoun_result.selectedIndex].text;;
                const wordanimal_result = document.querySelector('#animal_result'+x);
                const animal_result = wordanimal_result.options[wordanimal_result.selectedIndex].text;;
                const wordplants_result = document.querySelector('#plants_result'+x);
                const plants_result = wordplants_result.options[wordplants_result.selectedIndex].text;;
                const wordcountries_result = document.querySelector('#countries_result'+x);
                const countries_result = wordcountries_result.options[wordcountries_result.selectedIndex].text;;
                const wordinanimate_result = document.querySelector('#inanimate_result'+x);
                const inanimate_result = wordinanimate_result.options[wordinanimate_result.selectedIndex].text;;
                var total =parseInt(noun_result)+parseInt(gnoun_result)+parseInt(animal_result)+parseInt(plants_result)+parseInt(countries_result)+parseInt(inanimate_result)
                document.querySelector('#sum'+x).innerHTML=total
                document.querySelector('#noun_result'+x).disabled = true;
                document.querySelector('#gnoun_result'+x).disabled = true;
                document.querySelector('#animal_result'+x).disabled = true;
                document.querySelector('#plants_result'+x).disabled = true;
                document.querySelector('#countries_result'+x).disabled = true;
                document.querySelector('#inanimate_result'+x).disabled = true;
                document.querySelector('#view').disabled = false;
                console.log('heere we go',x,noun_result,
                gnoun_result,
                animal_result,
                plants_result,
                countries_result,
                inanimate_result)
                
       
                gameSocket2.send(JSON.stringify({
                  'noun_result':noun_result,
                  'gnoun_result':gnoun_result,
                  'animal_result':animal_result,
                  'plants_result':plants_result,
                  'countries_result':countries_result,
                  'inanimate_result':inanimate_result,
                  'sum':total,
                  'UserName':x,
                  'Noun' : b,
                  'gnoun':c,
                  'animal':d,
                  'plants':r,
                  'countries':g,
                  'inanimate':f,
                  'admin_letter':a,
                  'review':true,
                  'RoomCode':h,
                  'error':true,
                  'result':true,
                  'private':true
                  
                }))}
               
    
    document.getElementById('view').onclick=function(e){

    
      const gameSocketlettr3 = new WebSocket(
      'ws://' + window.location.host + '/ws/' + roomCode + '/letter/'
      )
      gameSocketlettr3.onopen = function(){
        gameSocketlettr3.send(JSON.stringify({
         'wantletter':'value',
          'wantletter1':'value',
          'RoomCode':roomCode
      }))
      gameSocketlettr3.onmessage=function(e){
        const data = JSON.parse(e.data)
        if (data.choosens){
          document.querySelector('#leetter').innerHTML =data.choosens;
          gameSocket2.send(JSON.stringify({
            'letterconsumer':data.choosens
          }))
           
        }
      }
    }}
    
  
</script>
{% endblock %}
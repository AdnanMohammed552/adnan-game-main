{% extends 'base.html' %}

{% block content %}
<head>
	<title>QR Code Scanner</title>
  <script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.18.4"></script>
  <h3 id="camera_correct"></h3>
       {{ room_code|json_script:'json-roomcode' }}

	<script>
    const codeReader = new ZXing.BrowserQRCodeReader();
    
    const roomCode = JSON.parse(document.getElementById('json-roomcode').textContent);

    const ws = new WebSocket('wss://' + window.location.host + '/ws/' + roomCode + '/quiz/');
	ws.onmessage = function(e){
        const data = JSON.parse(e.data)
		if (data.camera_correct != false){
			document.getElementById('camera_correct').innerHTML = data.camera_correct
		}
	}

		function scan() {
			codeReader.decodeFromInputVideoDevice(undefined, 'video').then((result) => {
				// Send WebSocket message with scanned code
				ws.send(JSON.stringify({'exam':result.text}));
				// Scan again
				scan();
			}).catch((err) => {
				console.error(err);
				// Scan again
				scan();
			});
		}

		ws.onopen = function(event) {
			// Start scanning for QR codes
			scan();
		};
	</script>
</head>
<body>
	<style>
		.video-container {
			position: relative;
			width: 100%;
			height: 0;
			padding-bottom: 56.25%;
		  }
		  
		  #video {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			object-fit: cover;
		  }
		  
		  
		  
	</style>
	<div class="video-container">
	  
	<video id="video" width="1000" height="1000" autoplay="autoplay" playsinline autoplay controls></video>
	</div>

	<script>
		
		const videoContainer = document.querySelector('.video-container');

function resizeVideoContainer() {
  const screenHeight = window.innerHeight;
  const videoContainerHeight = screenHeight - videoContainer.offsetTop;
  videoContainer.style.height = `${videoContainerHeight}px`;
}

window.addEventListener('resize', resizeVideoContainer);
resizeVideoContainer();

	</script>
</body>
{% endblock %}
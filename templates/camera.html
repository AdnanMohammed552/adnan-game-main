<!DOCTYPE html>
<html>
<head>
	<title>QR Code Scanner</title>
  <script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.18.4"></script>
      {{ room_code|json_script:'json-roomcode' }}

	<script>
    const codeReader = new ZXing.BrowserQRCodeReader();
    
    const roomCode = JSON.parse(document.getElementById('json-roomcode').textContent);

    const ws = new WebSocket('wss://' + window.location.host + '/ws/' + roomCode + '/quiz/');

		function scan() {
			codeReader.decodeFromInputVideoDevice(undefined, 'video').then((result) => {
				// Send WebSocket message with scanned code
				ws.send(JSON.stringify({'exam':result.text}));
				// Scan again
				scan();
			}).catch((err) => {
				console.error(err);
				// Scan again
				scan();
			});
		}

		ws.onopen = function(event) {
			// Start scanning for QR codes
			scan();
		};
	</script>
</head>
<body>
	<video id="video" width="300" height="200" autoplay="autoplay"></video>
</body>
</html>
